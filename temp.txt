# Form implementation generated from reading ui file 'main_mindow.ui'
#
# Created by: PyQt6 UI code generator 6.1.0
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt6 import QtCore, QtGui, QtWidgets
from drivers import NIDAQ


class ADCThread(QtCore.QThread):
    adc_data = QtCore.pyqtSignal(object)

    def __init__(self, adc_config, stop_signal):
        self.adc = NIDAQ.NIDAQ(
            dev_id=adc_config['dev_id'],
            rate=adc_config['rate'],
            acq_time=adc_config['acq_time'],
            channels=adc_config['channels'],
            volt_range=adc_config['range'])
        self.n_channels = len(adc_config['channels'])
        self.quit = False
        stop_signal.connect(self.stop)

    def run(self) -> None:
        while not self.quit:
            data = self.adc.get()
            result = ';'.join(['{:0.5f}'.format(d) for d in data])
            self.adc_data.emit(result)

    def stop(self):
        self.quit = True


class Ui_main_window(object):
    def setupUi(self, main_window):
        main_window.setObjectName("main_window")
        main_window.resize(1024, 768)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Fixed, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(main_window.sizePolicy().hasHeightForWidth())
        main_window.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(14)
        main_window.setFont(font)
        self.centralwidget = QtWidgets.QWidget(main_window)
        self.centralwidget.setObjectName("centralwidget")
        self.type_box_1 = QtWidgets.QComboBox(self.centralwidget)
        self.type_box_1.setGeometry(QtCore.QRect(28, 120, 150, 40))
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Fixed, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.type_box_1.sizePolicy().hasHeightForWidth())
        self.type_box_1.setSizePolicy(sizePolicy)
        self.type_box_1.setCurrentText("")
        self.type_box_1.setMaxVisibleItems(5)
        self.type_box_1.setObjectName("type_box_1")
        main_window.setCentralWidget(self.centralwidget)
        self.statusbar = QtWidgets.QStatusBar(main_window)
        self.statusbar.setObjectName("statusbar")
        main_window.setStatusBar(self.statusbar)

        self.retranslateUi(main_window)
        self.type_box_1.setCurrentIndex(-1)
        QtCore.QMetaObject.connectSlotsByName(main_window)

        config = {
            'dev_id': 'Dev1',
            'rate': 1000,
            'acq_time': 0.2,
            'channels': (0, 1, 2, 3, 4, 5, 6, 7),
            'range': 5,
        }
        self.adc_stop = QtCore.pyqtSignal(object)
        adc = ADCThread(adc_config=config, stop_signal=self.adc_stop)

    def update_fields(self, data):
        pass

    def retranslateUi(self, main_window):
        _translate = QtCore.QCoreApplication.translate
        main_window.setWindowTitle(_translate("main_window", "Тестер датчиков удара"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    main_window = QtWidgets.QMainWindow()
    ui = Ui_main_window()
    ui.setupUi(main_window)
    main_window.show()
    sys.exit(app.exec())
